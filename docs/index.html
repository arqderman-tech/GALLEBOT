<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>La Gallega ‚Äì Tracker de Precios</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&family=IBM+Plex+Sans:wght@400;600;700&display=swap');
  :root {
    --bg:#0f1117; --surface:#1a1d27; --border:#2a2d3a;
    --accent:#10b981; --red:#ef4444; --green:#22c55e;
    --text:#e2e8f0; --muted:#64748b;
  }
  * { box-sizing:border-box; margin:0; padding:0; }
  body { background:var(--bg); color:var(--text); font-family:'IBM Plex Sans',sans-serif; }
  header {
    background:var(--surface); border-bottom:1px solid var(--border);
    padding:1.5rem 2rem; display:flex; justify-content:space-between;
    align-items:center; flex-wrap:wrap; gap:1rem;
  }
  header h1 { font-family:'IBM Plex Mono',monospace; font-size:1.3rem; color:var(--accent); }
  .container { max-width:1200px; margin:0 auto; padding:2rem 1rem; }
  .hero { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:1rem; margin-bottom:2rem; }
  .stat-card {
    background:var(--surface); border:1px solid var(--border);
    border-radius:12px; padding:1.5rem; text-align:center;
  }
  .stat-card .label { font-size:0.72rem; text-transform:uppercase; letter-spacing:0.1em; color:var(--muted); margin-bottom:0.5rem; }
  .stat-card .value { font-family:'IBM Plex Mono',monospace; font-size:2rem; font-weight:700; }
  .section { margin-bottom:2.5rem; }
  .section-title {
    font-family:'IBM Plex Mono',monospace; font-size:0.75rem;
    text-transform:uppercase; letter-spacing:0.15em; color:var(--muted);
    margin-bottom:1rem; padding-bottom:0.5rem; border-bottom:1px solid var(--border);
  }
  .tabs { display:flex; gap:0.5rem; margin-bottom:1.5rem; flex-wrap:wrap; }
  .tab {
    padding:0.4rem 1rem; border-radius:6px; border:1px solid var(--border);
    background:transparent; color:var(--muted); cursor:pointer;
    font-family:'IBM Plex Mono',monospace; font-size:0.8rem; transition:all 0.2s;
  }
  .tab.active, .tab:hover { background:var(--accent); color:#000; border-color:var(--accent); }
  .chart-container {
    background:var(--surface); border:1px solid var(--border);
    border-radius:12px; padding:1.5rem; position:relative; height:320px;
  }
  .table-wrap { overflow-x:auto; }
  table { width:100%; border-collapse:collapse; font-size:0.88rem; }
  th {
    background:var(--surface); padding:0.7rem 1rem; text-align:left;
    font-size:0.7rem; text-transform:uppercase; letter-spacing:0.08em;
    color:var(--muted); border-bottom:1px solid var(--border);
  }
  td { padding:0.65rem 1rem; border-bottom:1px solid var(--border); }
  tr:hover td { background:rgba(255,255,255,0.02); }
  .rank-num { font-family:'IBM Plex Mono',monospace; color:var(--muted); font-size:0.75rem; }
  .rank-tabs { display:flex; gap:0.5rem; margin-bottom:1rem; }
  .rank-tab {
    padding:0.35rem 0.9rem; border-radius:6px; border:1px solid var(--border);
    background:transparent; color:var(--muted); cursor:pointer; font-size:0.8rem; transition:all 0.2s;
  }
  .rank-tab.active { background:var(--surface); color:var(--text); border-color:var(--accent); }
  .grid2 { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; }
  @media(max-width:700px){ .grid2{grid-template-columns:1fr;} }
  footer {
    text-align:center; padding:2rem; color:var(--muted); font-size:0.75rem;
    border-top:1px solid var(--border); font-family:'IBM Plex Mono',monospace;
  }
</style>
</head>
<body>

<header>
  <div>
    <h1>üõí LA GALLEGA ¬∑ PRICE TRACKER</h1>
    <div style="color:var(--muted);font-size:0.8rem;margin-top:0.2rem">Seguimiento diario de precios</div>
  </div>
  <div style="font-size:0.8rem;color:var(--muted);font-family:'IBM Plex Mono',monospace">√öltima actualizaci√≥n: 26/02/2026 13:08</div>
</header>

<div class="container">

  <div class="hero" style="margin-top:1.5rem">
    <div class="stat-card">
      <div class="label">Variaci√≥n Hoy</div>
      <div class="value" style="color:#ef4444">+0.28%</div>
      <div style="font-size:0.8rem;color:var(--muted);margin-top:0.3rem">5381 productos relevados</div>
    </div>
    <div class="stat-card">
      <div class="label">Variaci√≥n 30 d√≠as</div>
      <div class="value" style="color:#888">‚Äî</div>
    </div>
    <div class="stat-card">
      <div class="label">Variaci√≥n 1 a√±o</div>
      <div class="value" style="color:#888">‚Äî</div>
    </div>
    <div class="stat-card">
      <div class="label">Movimiento Hoy</div>
      <div style="display:flex;justify-content:center;gap:1rem;margin-top:0.5rem">
        <div><div style="color:#ef4444;font-size:1.3rem;font-weight:700;font-family:'IBM Plex Mono',monospace">‚¨Ü 74</div><div style="font-size:0.7rem;color:var(--muted)">Subieron</div></div>
        <div><div style="color:#22c55e;font-size:1.3rem;font-weight:700;font-family:'IBM Plex Mono',monospace">‚¨á 40</div><div style="font-size:0.7rem;color:var(--muted)">Bajaron</div></div>
        <div><div style="color:#888;font-size:1.3rem;font-weight:700;font-family:'IBM Plex Mono',monospace">‚û° 2271</div><div style="font-size:0.7rem;color:var(--muted)">Igual</div></div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-title">üìà Evoluci√≥n de precios</div>
    <div class="tabs">
      <button class="tab active" onclick="cambiarPeriodo('7d',this)">7 d√≠as</button>
      <button class="tab" onclick="cambiarPeriodo('30d',this)">30 d√≠as</button>
      <button class="tab" onclick="cambiarPeriodo('6m',this)">6 meses</button>
      <button class="tab" onclick="cambiarPeriodo('1y',this)">1 a√±o</button>
    </div>
    <div class="chart-container"><canvas id="chartGeneral"></canvas></div>
  </div>

  <div class="section">
    <div class="section-title">üìä Evoluci√≥n por categor√≠a</div>
    <div id="selectorCat" style="margin-bottom:1rem;display:flex;gap:0.5rem;flex-wrap:wrap"></div>
    <div class="chart-container"><canvas id="chartCat"></canvas></div>
  </div>

  <div class="section">
    <div class="section-title">üóÇ Variaci√≥n por categor√≠a ‚Äî hoy</div>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Categor√≠a</th><th>Variaci√≥n %</th><th>Subieron</th><th>Bajaron</th><th>Total</th></tr></thead>
        <tbody>
        <tr>
          <td>Frescos</td>
          <td style="color:#ef4444;font-weight:700">+0.38%</td>
          <td style="color:#ef4444">‚¨Ü 18</td>
          <td style="color:#22c55e">‚¨á 28</td>
          <td>989</td>
        </tr>
        <tr>
          <td>Limpieza</td>
          <td style="color:#ef4444;font-weight:700">+0.48%</td>
          <td style="color:#ef4444">‚¨Ü 48</td>
          <td style="color:#22c55e">‚¨á 4</td>
          <td>649</td>
        </tr>
        <tr>
          <td>Cuidado Personal</td>
          <td style="color:#22c55e;font-weight:700">-0.02%</td>
          <td style="color:#ef4444">‚¨Ü 8</td>
          <td style="color:#22c55e">‚¨á 8</td>
          <td>747</td>
        </tr></tbody>
      </table>
    </div>
  </div>

  <div class="section">
    <div class="section-title">üèÜ Rankings de productos</div>
    <div class="rank-tabs">
      <button class="rank-tab active" onclick="mostrarRanking('dia',this)">üìÖ Hoy</button>
      <button class="rank-tab" onclick="mostrarRanking('mes',this)">üìÜ 30 d√≠as</button>
      <button class="rank-tab" onclick="mostrarRanking('anio',this)">üìÖ 1 a√±o</button>
    </div>
    <div class="grid2">
      <div>
        <div style="font-size:0.8rem;color:var(--muted);margin-bottom:0.7rem">üî• Los que m√°s SUBIERON</div>
        <div class="table-wrap">
          <table><thead><tr><th>#</th><th>Producto</th><th>Var %</th><th>Precio</th></tr></thead>
          <tbody id="tabla-sube"></tbody></table>
        </div>
      </div>
      <div>
        <div style="font-size:0.8rem;color:var(--muted);margin-bottom:0.7rem">üìâ Los que m√°s BAJARON hoy</div>
        <div class="table-wrap">
          <table><thead><tr><th>#</th><th>Producto</th><th>Var %</th><th>Precio</th></tr></thead>
          <tbody id="tabla-baja"></tbody></table>
        </div>
      </div>
    </div>
  </div>

</div>

<footer>
  Datos relevados de lagallega.com.ar ¬∑ Actualizaci√≥n autom√°tica diaria via GitHub Actions<br>
  Los precios pueden variar seg√∫n sucursal y disponibilidad
</footer>

<script>
const GRAFICOS = {"7d": {"total": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.12}, {"fecha": "2026-02-23", "pct": 0.12}, {"fecha": "2026-02-24", "pct": 1.25}, {"fecha": "2026-02-25", "pct": 1.25}, {"fecha": "2026-02-26", "pct": 1.53}], "categorias": {"Bebidas": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.0}, {"fecha": "2026-02-23", "pct": 0.0}, {"fecha": "2026-02-24", "pct": 1.74}, {"fecha": "2026-02-25", "pct": 1.74}, {"fecha": "2026-02-26", "pct": 1.74}], "Frescos": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.49}, {"fecha": "2026-02-23", "pct": 0.49}, {"fecha": "2026-02-24", "pct": 0.45}, {"fecha": "2026-02-25", "pct": 0.45}, {"fecha": "2026-02-26", "pct": 0.83}], "Congelados": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.09}, {"fecha": "2026-02-23", "pct": 0.09}, {"fecha": "2026-02-24", "pct": 0.28}, {"fecha": "2026-02-25", "pct": 0.28}, {"fecha": "2026-02-26", "pct": 0.28}], "Limpieza": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.21}, {"fecha": "2026-02-23", "pct": 0.21}, {"fecha": "2026-02-24", "pct": 0.28}, {"fecha": "2026-02-25", "pct": 0.28}, {"fecha": "2026-02-26", "pct": 0.76}], "Cuidado Personal": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.01}, {"fecha": "2026-02-23", "pct": 0.01}, {"fecha": "2026-02-24", "pct": 1.86}, {"fecha": "2026-02-25", "pct": 1.86}, {"fecha": "2026-02-26", "pct": 1.84}]}}, "30d": {"total": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.12}, {"fecha": "2026-02-23", "pct": 0.12}, {"fecha": "2026-02-24", "pct": 1.25}, {"fecha": "2026-02-25", "pct": 1.25}, {"fecha": "2026-02-26", "pct": 1.53}], "categorias": {"Bebidas": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.0}, {"fecha": "2026-02-23", "pct": 0.0}, {"fecha": "2026-02-24", "pct": 1.74}, {"fecha": "2026-02-25", "pct": 1.74}, {"fecha": "2026-02-26", "pct": 1.74}], "Frescos": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.49}, {"fecha": "2026-02-23", "pct": 0.49}, {"fecha": "2026-02-24", "pct": 0.45}, {"fecha": "2026-02-25", "pct": 0.45}, {"fecha": "2026-02-26", "pct": 0.83}], "Congelados": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.09}, {"fecha": "2026-02-23", "pct": 0.09}, {"fecha": "2026-02-24", "pct": 0.28}, {"fecha": "2026-02-25", "pct": 0.28}, {"fecha": "2026-02-26", "pct": 0.28}], "Limpieza": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.21}, {"fecha": "2026-02-23", "pct": 0.21}, {"fecha": "2026-02-24", "pct": 0.28}, {"fecha": "2026-02-25", "pct": 0.28}, {"fecha": "2026-02-26", "pct": 0.76}], "Cuidado Personal": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.01}, {"fecha": "2026-02-23", "pct": 0.01}, {"fecha": "2026-02-24", "pct": 1.86}, {"fecha": "2026-02-25", "pct": 1.86}, {"fecha": "2026-02-26", "pct": 1.84}]}}, "6m": {"total": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.12}, {"fecha": "2026-02-23", "pct": 0.12}, {"fecha": "2026-02-24", "pct": 1.25}, {"fecha": "2026-02-25", "pct": 1.25}, {"fecha": "2026-02-26", "pct": 1.53}], "categorias": {"Bebidas": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.0}, {"fecha": "2026-02-23", "pct": 0.0}, {"fecha": "2026-02-24", "pct": 1.74}, {"fecha": "2026-02-25", "pct": 1.74}, {"fecha": "2026-02-26", "pct": 1.74}], "Frescos": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.49}, {"fecha": "2026-02-23", "pct": 0.49}, {"fecha": "2026-02-24", "pct": 0.45}, {"fecha": "2026-02-25", "pct": 0.45}, {"fecha": "2026-02-26", "pct": 0.83}], "Congelados": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.09}, {"fecha": "2026-02-23", "pct": 0.09}, {"fecha": "2026-02-24", "pct": 0.28}, {"fecha": "2026-02-25", "pct": 0.28}, {"fecha": "2026-02-26", "pct": 0.28}], "Limpieza": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.21}, {"fecha": "2026-02-23", "pct": 0.21}, {"fecha": "2026-02-24", "pct": 0.28}, {"fecha": "2026-02-25", "pct": 0.28}, {"fecha": "2026-02-26", "pct": 0.76}], "Cuidado Personal": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.01}, {"fecha": "2026-02-23", "pct": 0.01}, {"fecha": "2026-02-24", "pct": 1.86}, {"fecha": "2026-02-25", "pct": 1.86}, {"fecha": "2026-02-26", "pct": 1.84}]}}, "1y": {"total": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.12}, {"fecha": "2026-02-23", "pct": 0.12}, {"fecha": "2026-02-24", "pct": 1.25}, {"fecha": "2026-02-25", "pct": 1.25}, {"fecha": "2026-02-26", "pct": 1.53}], "categorias": {"Bebidas": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.0}, {"fecha": "2026-02-23", "pct": 0.0}, {"fecha": "2026-02-24", "pct": 1.74}, {"fecha": "2026-02-25", "pct": 1.74}, {"fecha": "2026-02-26", "pct": 1.74}], "Frescos": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.49}, {"fecha": "2026-02-23", "pct": 0.49}, {"fecha": "2026-02-24", "pct": 0.45}, {"fecha": "2026-02-25", "pct": 0.45}, {"fecha": "2026-02-26", "pct": 0.83}], "Congelados": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.09}, {"fecha": "2026-02-23", "pct": 0.09}, {"fecha": "2026-02-24", "pct": 0.28}, {"fecha": "2026-02-25", "pct": 0.28}, {"fecha": "2026-02-26", "pct": 0.28}], "Limpieza": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.21}, {"fecha": "2026-02-23", "pct": 0.21}, {"fecha": "2026-02-24", "pct": 0.28}, {"fecha": "2026-02-25", "pct": 0.28}, {"fecha": "2026-02-26", "pct": 0.76}], "Cuidado Personal": [{"fecha": "2026-02-20", "pct": 0.0}, {"fecha": "2026-02-22", "pct": 0.01}, {"fecha": "2026-02-23", "pct": 0.01}, {"fecha": "2026-02-24", "pct": 1.86}, {"fecha": "2026-02-25", "pct": 1.86}, {"fecha": "2026-02-26", "pct": 1.84}]}}};
const RANK_DIA  = [{"ean": "790757856899", "nombre": "llave ajustable 8", "categoria": "Limpieza", "precio_antes": 8150.0, "precio_hoy": 15403.0, "diff_abs": 7253.0, "diff_pct": 88.99}, {"ean": "2029040000007", "nombre": "salame lario picado grueso x metro envasado al vacio  x kilo", "categoria": "Lacteos Y Frescos", "precio_antes": 21529.0, "precio_hoy": 35582.0, "diff_abs": 14053.0, "diff_pct": 65.27}, {"ean": "2029030000000", "nombre": "salame lario picao fino x metro envasado al vacio  x kilo", "categoria": "Lacteos Y Frescos", "precio_antes": 21529.0, "precio_hoy": 35582.0, "diff_abs": 14053.0, "diff_pct": 65.27}, {"ean": "2018940000002", "nombre": "salame lario tipo crespon x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 21159.0, "precio_hoy": 34966.0, "diff_abs": 13807.0, "diff_pct": 65.25}, {"ean": "2018810000002", "nombre": "panceta salada lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 23479.01, "precio_hoy": 33532.0, "diff_abs": 10052.99, "diff_pct": 42.82}, {"ean": "2018710000003", "nombre": "lomo a las finas hierbas lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 23809.0, "precio_hoy": 34000.0, "diff_abs": 10191.0, "diff_pct": 42.8}, {"ean": "2019000000000", "nombre": "salamin tandilero lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 22029.0, "precio_hoy": 31457.0, "diff_abs": 9428.0, "diff_pct": 42.8}, {"ean": "2018990000007", "nombre": "salamin lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 22029.0, "precio_hoy": 31457.0, "diff_abs": 9428.0, "diff_pct": 42.8}, {"ean": "2018640000005", "nombre": "jamon cocido lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 13899.0, "precio_hoy": 19841.0, "diff_abs": 5942.0, "diff_pct": 42.75}, {"ean": "7798028020294", "nombre": "te pajaro azul x 25 saquitos", "categoria": "Perfumeria", "precio_antes": 689.0, "precio_hoy": 968.0, "diff_abs": 279.0, "diff_pct": 40.49}, {"ean": "2018840000003", "nombre": "salame de milan lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 21259.0, "precio_hoy": 29586.0, "diff_abs": 8327.0, "diff_pct": 39.17}, {"ean": "2018670000006", "nombre": "jamon crudo lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 43269.0, "precio_hoy": 58853.0, "diff_abs": 15584.0, "diff_pct": 36.02}, {"ean": "2019020000004", "nombre": "salchichon primavera lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 7279.0, "precio_hoy": 9849.0, "diff_abs": 2570.0, "diff_pct": 35.31}, {"ean": "2018560000000", "nombre": "cantimpalo lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 20219.0, "precio_hoy": 27354.0, "diff_abs": 7135.0, "diff_pct": 35.29}, {"ean": "2029320000000", "nombre": "bondiola lario x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 27449.0, "precio_hoy": 37133.0, "diff_abs": 9684.0, "diff_pct": 35.28}, {"ean": "2018630000008", "nombre": "jamon cocido lario premium x kilo x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 18729.0, "precio_hoy": 25333.0, "diff_abs": 6604.0, "diff_pct": 35.26}, {"ean": "7790625000648", "nombre": "leberwurst lario x 200 gr.", "categoria": "Lacteos Y Frescos", "precio_antes": 1819.0, "precio_hoy": 2459.0, "diff_abs": 640.0, "diff_pct": 35.18}, {"ean": "7791451071000", "nombre": "dulce de batanta esnaola x 500 gr.", "categoria": "Perfumeria", "precio_antes": 1929.0, "precio_hoy": 2543.0, "diff_abs": 614.0, "diff_pct": 31.83}, {"ean": "7791451080040", "nombre": "dulce de membrillo esnaola x 500 gm", "categoria": "Perfumeria", "precio_antes": 2649.0, "precio_hoy": 3486.0, "diff_abs": 837.0, "diff_pct": 31.6}, {"ean": "7790625010401", "nombre": "salchichas 66 x 6 unid.", "categoria": "Lacteos Y Frescos", "precio_antes": 949.0, "precio_hoy": 1198.0, "diff_abs": 249.0, "diff_pct": 26.24}];
const RANK_MES  = [];
const RANK_ANIO = [];
const RANK_BAJA = [{"ean": "7898024395232", "nombre": "pasta de avellanas y chocolate nutella x 140 gr.", "categoria": "Perfumeria", "precio_antes": 4935.0, "precio_hoy": 3169.0, "diff_abs": -1766.0, "diff_pct": -35.79}, {"ean": "2020270000003", "nombre": "cebolla x kg.", "categoria": "Frutas Y Verduras", "precio_antes": 1490.0, "precio_hoy": 990.0, "diff_abs": -500.0, "diff_pct": -33.56}, {"ean": "7790387011852", "nombre": "mate cocido taragui ni$os vainilla y miel x 20 saq", "categoria": "Perfumeria", "precio_antes": 2290.0, "precio_hoy": 1529.0, "diff_abs": -761.0, "diff_pct": -33.23}, {"ean": "7790070507273", "nombre": "yerba mate nobleza gaucha seleccion x 500 ml.", "categoria": "Perfumeria", "precio_antes": 2290.0, "precio_hoy": 1669.0, "diff_abs": -621.0, "diff_pct": -27.12}, {"ean": "7790070100382", "nombre": "yerba nobleza gaucha x 1 kg cimarron", "categoria": "Perfumeria", "precio_antes": 4342.0, "precio_hoy": 3349.0, "diff_abs": -993.0, "diff_pct": -22.87}, {"ean": "7790070100375", "nombre": "yerba nobleza gaucha x 500 gr cimarron", "categoria": "Perfumeria", "precio_antes": 2289.0, "precio_hoy": 1769.0, "diff_abs": -520.0, "diff_pct": -22.72}, {"ean": "2019630000005", "nombre": "queso cuartirolo ilolay x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 13635.0, "precio_hoy": 11499.0, "diff_abs": -2136.0, "diff_pct": -15.67}, {"ean": "2019730000004", "nombre": "queso por salut ilolay x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 14994.0, "precio_hoy": 12649.0, "diff_abs": -2345.0, "diff_pct": -15.64}, {"ean": "7790360983954", "nombre": "salchichas swift x 12 unid.", "categoria": "Lacteos Y Frescos", "precio_antes": 4563.0, "precio_hoy": 3850.0, "diff_abs": -713.0, "diff_pct": -15.63}, {"ean": "2019610000001", "nombre": "queso cremoso ilolay x kg.", "categoria": "Lacteos Y Frescos", "precio_antes": 12856.0, "precio_hoy": 10849.0, "diff_abs": -2007.0, "diff_pct": -15.61}];

let periodoActual = '7d';
let chartGeneral = null, chartCat = null, catActual = null;

function cambiarPeriodo(periodo, btn) {
  periodoActual = periodo;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  renderChartGeneral(periodo);
  renderSelectorCats(periodo);
}

function renderChartGeneral(periodo) {
  const datos = GRAFICOS[periodo]?.total || [];
  if (chartGeneral) chartGeneral.destroy();
  const ctx = document.getElementById('chartGeneral').getContext('2d');
  chartGeneral = new Chart(ctx, {
    type: 'line',
    data: {
      labels: datos.map(d => d.fecha),
      datasets: [{ label: 'Variaci√≥n acumulada %', data: datos.map(d => d.pct),
        borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.08)',
        borderWidth: 2, pointRadius: datos.length > 60 ? 0 : 3, tension: 0.3, fill: true }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { color: '#64748b', maxTicksLimit: 8 }, grid: { color: '#2a2d3a' } },
        y: {
          ticks: { color: '#64748b', callback: v => (v>0?'+':'')+v.toFixed(1)+'%' },
          grid: { color: '#2a2d3a' },
          afterDataLimits: a => { if(a.min>0) a.min=0; if(a.max<0) a.max=0; }
        }
      }
    }
  });
}

function renderSelectorCats(periodo) {
  const CATS_DEFAULT = ["Almac\u00e9n", "Bebidas", "Frescos", "Congelados", "Limpieza", "Cuidado Personal"];
  const catsJSON = Object.keys(GRAFICOS[periodo]?.categorias || {});
  const cats = catsJSON.length ? catsJSON : CATS_DEFAULT;
  const cont = document.getElementById('selectorCat');
  cont.innerHTML = '';
  if (!catActual || !cats.includes(catActual)) catActual = cats[0];
  cats.forEach(cat => {
    const btn = document.createElement('button');
    btn.className = 'tab' + (cat === catActual ? ' active' : '');
    btn.textContent = cat;
    btn.onclick = () => {
      catActual = cat;
      document.querySelectorAll('#selectorCat .tab').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      renderChartCat(periodo, cat);
    };
    cont.appendChild(btn);
  });
  renderChartCat(periodo, catActual);
}

function renderChartCat(periodo, cat) {
  const datos = GRAFICOS[periodo]?.categorias?.[cat] || [];
  if (chartCat) chartCat.destroy();
  const ctx = document.getElementById('chartCat').getContext('2d');
  chartCat = new Chart(ctx, {
    type: 'line',
    data: {
      labels: datos.map(d => d.fecha),
      datasets: [{ label: cat + ' ‚Äî variaci√≥n %', data: datos.map(d => d.pct),
        borderColor: '#60a5fa', backgroundColor: 'rgba(96,165,250,0.08)',
        borderWidth: 2, pointRadius: datos.length > 60 ? 0 : 3, tension: 0.3, fill: true }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { color: '#64748b', maxTicksLimit: 8 }, grid: { color: '#2a2d3a' } },
        y: {
          ticks: { color: '#64748b', callback: v => (v>0?'+':'')+v.toFixed(1)+'%' },
          grid: { color: '#2a2d3a' },
          afterDataLimits: a => { if(a.min>0) a.min=0; if(a.max<0) a.max=0; }
        }
      }
    }
  });
}

function mostrarRanking(periodo, btn) {
  document.querySelectorAll('.rank-tab').forEach(t => t.classList.remove('active'));
  btn.classList.add('active');
  const data = { dia: RANK_DIA, mes: RANK_MES, anio: RANK_ANIO }[periodo] || [];
  renderTablaRanking('tabla-sube', data, false);
  if (periodo === 'dia') renderTablaRanking('tabla-baja', RANK_BAJA, true);
  else document.getElementById('tabla-baja').innerHTML = '<tr><td colspan="4" style="color:var(--muted);text-align:center;padding:1rem">Solo disponible para hoy</td></tr>';
}

function renderTablaRanking(id, data, esBaja) {
  const tbody = document.getElementById(id);
  if (!data.length) {
    tbody.innerHTML = '<tr><td colspan="4" style="color:var(--muted);text-align:center;padding:1rem">Sin datos a√∫n</td></tr>';
    return;
  }
  tbody.innerHTML = data.slice(0,20).map((p,i) => {
    const pct = p.diff_pct;
    const color = esBaja ? '#22c55e' : '#ef4444';
    const precio = p.precio_hoy ? '$' + Number(p.precio_hoy).toLocaleString('es-AR') : '‚Äî';
    return `<tr>
      <td class="rank-num">${i+1}</td>
      <td title="${p.nombre}"><div>${(p.nombre||'').substring(0,35)}</div>
        <div style="font-size:0.7rem;color:var(--muted)">${(p.categoria||'').substring(0,25)}</div></td>
      <td style="color:${color};font-weight:700;font-family:'IBM Plex Mono',monospace">${pct>0?'+':''}${pct?.toFixed(1)}%</td>
      <td style="font-family:'IBM Plex Mono',monospace;font-size:0.82rem">${precio}</td>
    </tr>`;
  }).join('');
}

renderChartGeneral('7d');
renderSelectorCats('7d');
mostrarRanking('dia', document.querySelector('.rank-tab'));
</script>
</body>
</html>